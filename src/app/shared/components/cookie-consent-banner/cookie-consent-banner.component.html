<!-- Cookie Consent Banner -->
@if (showBanner()) {
    <div class="cookie-consent-banner fixed bottom-0 left-0 right-0 bg-white dark:bg-surface-800 border-t border-surface-200 dark:border-surface-600 shadow-lg z-[9999] p-4 md:p-6">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <!-- Content -->
                <div class="flex-1">
                    <div class="flex items-start gap-3">
                        <i class="pi pi-info-circle text-primary-500 text-xl mt-1 flex-shrink-0"></i>
                        <div>
                            <h3 class="font-semibold text-surface-900 dark:text-surface-0 mb-2">Gestion des cookies et confidentialité</h3>
                            <p class="text-sm text-surface-600 dark:text-surface-300 leading-relaxed">
                                Nous utilisons des cookies pour améliorer votre expérience sur notre site, analyser notre trafic et personnaliser le contenu. Vous pouvez choisir quels types de cookies accepter.
                                <a routerLink="/mentions-legales" class="text-primary-500 hover:text-primary-600 underline ml-1"> En savoir plus sur notre politique de confidentialité </a>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-col sm:flex-row gap-2 lg:flex-shrink-0">
                    <p-button label="Paramètres" severity="secondary" [outlined]="true" size="small" (onClick)="showSettings()" class="order-3 sm:order-1"> </p-button>

                    <p-button label="Accepter les essentiels" severity="secondary" size="small" (onClick)="acceptEssentialOnly()" class="order-2"> </p-button>

                    <p-button label="Tout accepter" severity="primary" size="small" (onClick)="acceptAll()" class="order-1 sm:order-3"> </p-button>
                </div>
            </div>
        </div>
    </div>
}

<!-- Detailed Settings Dialog -->
<p-dialog header="Paramètres des cookies" [modal]="true" [draggable]="false" [resizable]="false" [closable]="true" [(visible)]="showDetailsDialog" [style]="{ width: '90vw', maxWidth: '600px' }" (onHide)="cancelSettings()">
    <div class="space-y-6">
        <!-- Introduction -->
        <div class="pb-4 border-b border-surface-200 dark:border-surface-600">
            <p class="text-surface-600 dark:text-surface-300 text-sm leading-relaxed">Choisissez les types de cookies que vous souhaitez autoriser. Ces paramètres affecteront uniquement ce navigateur et cet appareil.</p>
        </div>

        <!-- Cookie Categories -->
        <div class="space-y-4">
            <!-- Essential Cookies -->
            <div class="cookie-category p-4 border border-surface-200 dark:border-surface-600 rounded-lg bg-surface-50 dark:bg-surface-700">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold text-surface-900 dark:text-surface-0 mb-2 flex items-center gap-2">
                            <i class="pi pi-lock text-green-500"></i>
                            Cookies essentiels
                        </h4>
                        <p class="text-sm text-surface-600 dark:text-surface-300 mb-2">
                            Ces cookies sont nécessaires au fonctionnement du site et ne peuvent pas être désactivés. Ils incluent l'authentification, la sécurité et les préférences de base.
                        </p>
                        <div class="text-xs text-surface-500 dark:text-surface-400"><strong>Exemples :</strong> Session utilisateur, tokens d'authentification, préférences de sécurité</div>
                    </div>
                    <div class="ml-4">
                        <p-checkbox [binary]="true" [value]="true" [disabled]="true" inputId="essential"> </p-checkbox>
                    </div>
                </div>
            </div>

            <!-- Functional Cookies -->
            <div class="cookie-category p-4 border border-surface-200 dark:border-surface-600 rounded-lg">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold text-surface-900 dark:text-surface-0 mb-2 flex items-center gap-2">
                            <i class="pi pi-cog text-blue-500"></i>
                            Cookies fonctionnels
                        </h4>
                        <p class="text-sm text-surface-600 dark:text-surface-300 mb-2">Ces cookies permettent d'améliorer les fonctionnalités et la personnalisation du site, comme vos préférences de langue et de thème.</p>
                        <div class="text-xs text-surface-500 dark:text-surface-400"><strong>Exemples :</strong> Préférences de thème, configuration de l'interface, paramètres de langue</div>
                    </div>
                    <div class="ml-4">
                        <p-checkbox [binary]="true" [value]="customSettings().functional" (onChange)="updateFunctional($event.checked)" inputId="functional"> </p-checkbox>
                    </div>
                </div>
            </div>

            <!-- Analytics Cookies -->
            <div class="cookie-category p-4 border border-surface-200 dark:border-surface-600 rounded-lg">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold text-surface-900 dark:text-surface-0 mb-2 flex items-center gap-2">
                            <i class="pi pi-chart-line text-orange-500"></i>
                            Cookies analytiques
                        </h4>
                        <p class="text-sm text-surface-600 dark:text-surface-300 mb-2">Ces cookies nous aident à comprendre comment vous utilisez le site pour l'améliorer. Ils collectent des informations anonymes sur votre navigation.</p>
                        <div class="text-xs text-surface-500 dark:text-surface-400"><strong>Exemples :</strong> Pages visitées, temps passé sur le site, statistiques d'utilisation</div>
                    </div>
                    <div class="ml-4">
                        <p-checkbox [binary]="true" [value]="customSettings().analytics" (onChange)="updateAnalytics($event.checked)" inputId="analytics"> </p-checkbox>
                    </div>
                </div>
            </div>

            <!-- Marketing Cookies -->
            <div class="cookie-category p-4 border border-surface-200 dark:border-surface-600 rounded-lg">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold text-surface-900 dark:text-surface-0 mb-2 flex items-center gap-2">
                            <i class="pi pi-megaphone text-purple-500"></i>
                            Cookies marketing
                        </h4>
                        <p class="text-sm text-surface-600 dark:text-surface-300 mb-2">Ces cookies sont utilisés pour vous proposer des publicités personnalisées et mesurer l'efficacité de nos campagnes marketing.</p>
                        <div class="text-xs text-surface-500 dark:text-surface-400"><strong>Exemples :</strong> Publicités ciblées, suivi des conversions, remarketing</div>
                    </div>
                    <div class="ml-4">
                        <p-checkbox [binary]="true" [value]="customSettings().marketing" (onChange)="updateMarketing($event.checked)" inputId="marketing"> </p-checkbox>
                    </div>
                </div>
            </div>
        </div>

        <!-- Legal Links -->
        <div class="pt-4 border-t border-surface-200 dark:border-surface-600">
            <div class="flex flex-wrap gap-4 text-xs">
                <a routerLink="/mentions-legales" class="text-primary-500 hover:text-primary-600 underline"> Mentions légales </a>
                <a routerLink="/mentions-legales" class="text-primary-500 hover:text-primary-600 underline"> Politique de confidentialité </a>
                <a routerLink="/mentions-legales" class="text-primary-500 hover:text-primary-600 underline"> Politique des cookies </a>
            </div>
        </div>
    </div>

    <!-- Dialog Footer -->
    <ng-template pTemplate="footer">
        <div class="flex flex-col sm:flex-row gap-2 justify-end">
            <p-button label="Annuler" severity="secondary" [outlined]="true" size="small" (onClick)="cancelSettings()"> </p-button>

            <p-button label="Sauvegarder mes préférences" severity="primary" size="small" (onClick)="saveCustomSettings()"> </p-button>
        </div>
    </ng-template>
</p-dialog>
